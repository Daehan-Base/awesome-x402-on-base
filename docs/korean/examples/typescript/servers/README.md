[한국어](./README.md) | [English](./README.en.md)

# x402 Server 예제

이 디렉토리는 x402 결제 요구 사항을 사용해 API 엔드포인트를 보호하는 방법을 보여주는 타입스크립트 서버 예제들을 포함하고 있습니다.

## 디렉토리 구조

| 디렉토리                   | 설명                                       |
| -------------------------- | ------------------------------------------ |
| [`express/`](./express/)   | `@x402/express` 미들웨어 사용              |
| [`hono/`](./hono/)         | `@x402/hono` 미들웨어 사용                 |
| [`advanced/`](./advanced/) | 고급 패턴: 훅, 동적 가격 책정, 커스텀 토큰 |
| [`custom/`](./custom/)     | `@x402/core`만을 사용한 수동 구현          |

## 프레임워크 예제

**express** 및 **hono** 디렉토리는 API에 x402 페이월을 추가하는 최소 구성(minimal) 방식을 보여줍니다. 이 예제들은 아래 작업을 자동으로 처리하는 미들웨어 패키지를 사용합니다.

1. 보호된 라우트에서 결제 헤더 존재 여부 확인
2. 결제가 없으면 결제 요구 사항과 함께 402 응답 반환
3. Facilitator를 통해 결제 검증(verify) 수행
4. API 응답이 성공한 뒤 온체인 정산(settle) 수행

사용 중인 웹 프레임워크에 맞는 예제를 선택하면 됩니다.

## 고급 예제

**advanced** 디렉토리는 미들웨어가 지원하는 고급 기능들을 시연합니다.

- **라이프사이클 훅(Lifecycle Hooks)** — 검증/정산 전후에 사용자 정의 로직 실행
- **동적 가격(Dynamic Pricing)** — 요청 컨텍스트에 따라 런타임에 가격 산정
- **동적 PayTo(Dynamic PayTo)** — 요청마다 결제 수신자(payTo)를 다르게 라우팅
- **커스텀 토큰(Custom Tokens)** — USDC 이외의 토큰 결제 수락
- **바자르 디스커버리(Bazaar Discovery)** — 클라이언트 및 AI 에이전트가 API를 발견할 수 있도록 노출

이 패턴들은 비즈니스 로직 커스터마이징, 관측성(observability), 마켓플레이스 기능이 필요한 프로덕션 환경에 유용합니다.

## 커스텀 구현

**custom** 디렉토리는 미들웨어 없이 `@x402/core`만 사용하여 x402 결제 처리를 직접 구현하는 방법을 보여줍니다. 다음과 같은 경우에 적합합니다.

- 결제 플로우를 완전히 제어해야 하는 경우
- 패키지가 제공되지 않는 웹 프레임워크(Koa, Fastify 등)를 사용하는 경우
- x402의 내부 동작 원리를 깊이 이해하고 싶은 경우

## 시작하기

1. 원하는 예제 디렉토리를 선택합니다.
2. 해당 디렉토리의 README를 따라 진행합니다.
3. 서버 테스트를 위해 [클라이언트 예제](../clients/) 중 하나를 사용합니다.
